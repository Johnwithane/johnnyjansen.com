<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scrapbook Prototype</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: #f5f5f5;
      padding: 2rem;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .toolbar {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      background: #f0f0f0;
      border-bottom: 1px solid #ddd;
    }
    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid #ccc;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    .btn.active {
      background: #007bff;
      color: white;
      border-color: #007bff;
    }
    .btn:hover {
      background: #f8f9fa;
    }
    .btn.active:hover {
      background: #0056b3;
    }

    .canvas-wrapper {
      position: relative;
      height: 500px;
      overflow: hidden;
      background: #fafafa;
    }
    .canvas {
      position: relative;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
    }
    .scrap-item {
      position: absolute;
      user-select: none;
      cursor: move;
      transform: translate(-50%, -50%);
      pointer-events: auto;
      transition: none;
    }
    .scrap-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      pointer-events: none;
    }
    .scrap-item.emoji {
      font-size: 1em;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .scrap-item.selected {
      outline: 2px solid #007bff;
      outline-offset: 2px;
    }
    .resize-handle {
      position: absolute;
      right: -6px; bottom: -6px;
      width: 12px; height: 12px;
      background: #007bff;
      border: 2px solid white;
      border-radius: 50%;
      cursor: nwse-resize;
    }

    /* Controls attached to item */
    .controls {
      position: absolute;
      bottom: -56px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 0.6rem;
      display: flex;
      gap: 0.4rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      pointer-events: auto;
      z-index: 1000;
      animation: none !important;
    }
    .ctrl-btn {
      width: 32px; height: 32px;
      border: none;
      background: #f0f0f0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    .ctrl-btn:hover {
      background: #e0e0e0;
    }
    .ctrl-btn.active {
      background: #007bff;
      color: white;
    }

    /* Dropdown Menu */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    .dropdown-btn {
      width: 32px; height: 32px;
      background: #f0f0f0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .dropdown-btn.active {
      background: #007bff;
      color: white;
    }
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 6px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      min-width: 160px;
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transform: translateX(-50%) translateY(-8px);
      transition: all 0.2s ease;
    }
    .dropdown.open .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
    .dropdown-item {
      padding: 0.5rem 0.8rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background 0.2s;
    }
    .dropdown-item:hover {
      background: #f5f5f5;
    }
    .dropdown-item.active {
      background: #e3f2fd;
      color: #007bff;
      font-weight: 500;
    }

    .palette {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      background: #f9f9f9;
      border-top: 1px solid #eee;
    }
    .emoji-drag, .photo-sample {
      width: 60px; height: 60px;
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      transition: transform 0.2s;
    }
    .emoji-drag:active, .photo-sample:active {
      transform: scale(0.95);
    }
    .photo-sample img {
      width: 100%; height: 100%; object-fit: cover; border-radius: 6px;
    }
    .upload {
      padding: 1rem;
      text-align: center;
      border-top: 1px solid #eee;
      background: #f9f9f9;
    }
    .upload input { display: none; }
    .upload label {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: #007bff;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .upload label:hover {
      background: #0056b3;
    }

    /* Filters */
    .filter-bw { filter: grayscale(100%); }
    .filter-sepia { filter: sepia(80%); }
    .filter-vibrant { filter: saturate(180%) contrast(110%); }
    .filter-cool { filter: hue-rotate(200deg) brightness(1.1); }
    .filter-warm { filter: sepia(30%) saturate(130%) hue-rotate(20deg); }

    /* Animations - 4s loop */
    .content {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    @keyframes wiggle { 0%,100% { transform: rotate(0deg); } 25% { transform: rotate(8deg); } 50% { transform: rotate(-6deg); } 75% { transform: rotate(6deg); } }
    @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes hop { 0%,100% { transform: translateY(0); } 25% { transform: translateY(-20px); } 50% { transform: translateY(0); } 75% { transform: translateY(-10px); } }
    @keyframes zoom { 0%,100% { transform: scale(1); } 30% { transform: scale(1.3); } 60% { transform: scale(0.9); } 80% { transform: scale(1.15); } }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.25); } }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
    @keyframes sway { 0%,100% { transform: rotate(0deg); } 25% { transform: rotate(15deg); } 75% { transform: rotate(-15deg); } }
    @keyframes boing { 0% { transform: scale(1); } 40% { transform: scale(1.4, 0.8); } 60% { transform: scale(0.9, 1.3); } 80% { transform: scale(1.1, 0.95); } 100% { transform: scale(1); } }

    .anim-wiggle .content { animation: wiggle 4s ease-in-out infinite; }
    .anim-rotate .content { animation: rotate 4s linear infinite; }
    .anim-hop .content { animation: hop 4s ease-in-out infinite; }
    .anim-zoom .content { animation: zoom 4s ease-in-out infinite; }
    .anim-pulse .content { animation: pulse 4s ease-in-out infinite; }
    .anim-float .content { animation: float 4s ease-in-out infinite; }
    .anim-sway .content { animation: sway 4s ease-in-out infinite; }
    .anim-boing .content { animation: boing 4s ease-in-out infinite; }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="toolbar">
      <button class="btn" :class="{ active: mode === 'select' }" @click="setMode('select')">Select</button>
      <button class="btn" @click="refreshBackground">New BG</button>
      <button class="btn" @click="clearAll">Clear</button>
    </div>

    <div class="canvas-wrapper" @drop.prevent="drop" @dragover.prevent>
      <div class="canvas" :style="{ backgroundImage: `url(${bgUrl})` }">
        <!-- Items -->
        <div v-for="item in items" :key="item.id"
             class="scrap-item"
             :class="{ 
               selected: selectedId === item.id, 
               emoji: item.type === 'emoji',
               [item.anim]: item.anim,
               [item.filter]: item.filter
             }"
             :style="itemStyle(item)"
             @mousedown.stop="selectAndDrag($event, item.id)">
          
          <!-- Animated & Filtered content -->
          <div class="content">
            <img v-if="item.type === 'photo'" :src="item.src" />
            <div v-else>{{ item.emoji }}</div>
          </div>

          <!-- Resize handle -->
          <div class="resize-handle" @mousedown.stop="startResize($event, item.id)"></div>

          <!-- Per-item controls -->
          <div v-if="selectedId === item.id" class="controls">
            <!-- Animation Dropdown -->
            <div class="dropdown" :class="{ open: animOpen }">
              <button class="ctrl-btn dropdown-btn" :class="{ active: item.anim }" @click.stop="toggleDropdown('anim')">
                <span v-if="!item.anim">üéûÔ∏è</span>
                <span v-else>üéûÔ∏è</span>
              </button>
              <div class="dropdown-menu">
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-wiggle' }" @click.stop="setAnim(item, 'anim-wiggle')">Wiggle</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-rotate' }" @click.stop="setAnim(item, 'anim-rotate')">Rotate</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-hop' }" @click.stop="setAnim(item, 'anim-hop')">Hop</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-zoom' }" @click.stop="setAnim(item, 'anim-zoom')">Zoom</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-pulse' }" @click.stop="setAnim(item, 'anim-pulse')">Pulse</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-float' }" @click.stop="setAnim(item, 'anim-float')">Float</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-sway' }" @click.stop="setAnim(item, 'anim-sway')">Sway</div>
                <div class="dropdown-item" :class="{ active: item.anim === 'anim-boing' }" @click.stop="setAnim(item, 'anim-boing')">Boing!</div>
                <div class="dropdown-item" @click.stop="setAnim(item, null)">None</div>
              </div>
            </div>

            <!-- Filter Dropdown -->
            <div class="dropdown" :class="{ open: filterOpen }">
              <button class="ctrl-btn dropdown-btn" :class="{ active: item.filter }" @click.stop="toggleDropdown('filter')">
                üé®
              </button>
              <div class="dropdown-menu">
                <div class="dropdown-item" :class="{ active: item.filter === 'filter-bw' }" @click.stop="setFilter(item, 'filter-bw')">B&W</div>
                <div class="dropdown-item" :class="{ active: item.filter === 'filter-sepia' }" @click.stop="setFilter(item, 'filter-sepia')">Sepia</div>
                <div class="dropdown-item" :class="{ active: item.filter === 'filter-vibrant' }" @click.stop="setFilter(item, 'filter-vibrant')">Vibrant</div>
                <div class="dropdown-item" :class="{ active: item.filter === 'filter-cool' }" @click.stop="setFilter(item, 'filter-cool')">Cool</div>
                <div class="dropdown-item" :class="{ active: item.filter === 'filter-warm' }" @click.stop="setFilter(item, 'filter-warm')">Warm</div>
                <div class="dropdown-item" @click.stop="setFilter(item, null)">None</div>
              </div>
            </div>

            <!-- <button class="ctrl-btn" @click.stop="bringToFront">‚¨ÜÔ∏è</button>
            <button class="ctrl-btn" @click.stop="sendToBack">‚¨áÔ∏è</button> -->
            <button class="ctrl-btn" @click.stop="duplicate(item)">‚ßâ</button>
            <button class="ctrl-btn" @click.stop="remove(item)">X</button>
          </div>
        </div>
      </div>
    </div>

    <div class="upload">
      <label @click.stop>Upload Photos <input type="file" multiple accept="image/*" @change="uploadPhotos"></label>
    </div>

    <div class="palette">
      <span v-for="e in emojis" :key="e" class="emoji-drag" draggable="true" @dragstart="dragStart($event, 'emoji', e)">{{ e }}</span>
      <div v-for="p in samplePhotos" :key="p" class="photo-sample" draggable="true" @dragstart="dragStart($event, 'photo', p)">
        <img :src="p">
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
      setup() {
        const bgUrl = ref('');
        const items = ref([]);
        const nextId = ref(0);
        const selectedId = ref(null);
        const mode = ref('select');
        const animOpen = ref(false);
        const filterOpen = ref(false);

          const emojis = ['üòÇ', 'üòé', 'üëç', '‚ù§Ô∏è', 'üî•'];
        const samplePhotos = [
          'https://picsum.photos/200/200?random=1',
          'https://picsum.photos/200/200?random=2',
          'https://picsum.photos/200/200?random=3',
          'https://picsum.photos/200/200?random=4'
        ];

        onMounted(() => {
          refreshBackground();
        });

        const refreshBackground = () => {
          bgUrl.value = `https://picsum.photos/900/500?blur=2&random=${Date.now()}`;
        };

        const dragStart = (e, type, data) => {
          e.dataTransfer.setData('type', type);
          e.dataTransfer.setData('data', data);
        };

        const drop = (e) => {
          if (mode.value !== 'select') return;
          const type = e.dataTransfer.getData('type');
          const data = e.dataTransfer.getData('data');
          if (!type || !data) return;

          const rect = e.currentTarget.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          items.value.push({
            id: nextId.value++,
            type,
            [type === 'emoji' ? 'emoji' : 'src']: data,
            x, y,
            width: type === 'emoji' ? 50 : 120,
            height: type === 'emoji' ? 50 : 120,
            anim: null,
            filter: null,
            z: items.value.length
          });
        };

        const uploadPhotos = (e) => {
          Array.from(e.target.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = (ev) => {
              const img = new Image();
              img.onload = () => {
                items.value.push({
                  id: nextId.value++,
                  type: 'photo',
                  src: ev.target.result,
                  x: 300 + Math.random() * 200,
                  y: 200 + Math.random() * 150,
                  width: Math.min(img.width / 4, 150),
                  height: Math.min(img.height / 4, 150),
                  anim: null,
                  filter: null,
                  z: items.value.length
                });
              };
              img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
          });
        };

        const setMode = (m) => {
          mode.value = m;
        };

        let dragState = { active: false, id: null, startX: 0, startY: 0, initX: 0, initY: 0, initW: 0, initH: 0, mode: '' };

        const selectAndDrag = (e, id) => {
          if (mode.value !== 'select') return;
          selectedId.value = id;
          bringToFront(id);
          if (e.target.classList.contains('resize-handle')) {
            startResize(e, id);
            return;
          }
          dragState = { active: true, id, startX: e.clientX, startY: e.clientY, initX: find(id).x, initY: find(id).y, mode: 'move' };
          bindDrag();
        };

        const startResize = (e, id) => {
          const item = find(id);
          dragState = { active: true, id, startX: e.clientX, startY: e.clientY, initW: item.width, initH: item.height, mode: 'resize' };
          bindDrag();
        };

        const bindDrag = () => {
          document.addEventListener('mousemove', handleDrag);
          document.addEventListener('mouseup', stopDrag);
        };

        const handleDrag = (e) => {
          if (!dragState.active) return;
          const item = find(dragState.id);
          if (dragState.mode === 'move') {
            item.x = dragState.initX + (e.clientX - dragState.startX);
            item.y = dragState.initY + (e.clientY - dragState.startY);
          } else if (dragState.mode === 'resize') {
            const delta = (e.clientX - dragState.startX) + (e.clientY - dragState.startY);
            const newW = Math.max(20, dragState.initW + delta / 3);
            item.width = newW;
            item.height = newW * (dragState.initH / dragState.initW);
          }
        };

        const stopDrag = () => {
          dragState.active = false;
          document.removeEventListener('mousemove', handleDrag);
          document.removeEventListener('mouseup', stopDrag);
        };

        const find = (id) => items.value.find(i => i.id === id);

        const bringToFront = (id) => {
          const item = find(id || selectedId.value);
          if (!item) return;
          const maxZ = Math.max(...items.value.map(i => i.z), -1);
          item.z = maxZ + 1;
        };

        const sendToBack = (id) => {
          const item = find(id || selectedId.value);
          if (!item) return;
          const minZ = Math.min(...items.value.map(i => i.z), 1);
          item.z = minZ - 1;
        };

        const setAnim = (item, anim) => {
          item.anim = item.anim === anim ? null : anim;
          animOpen.value = false;
        };

        const setFilter = (item, filter) => {
          item.filter = item.filter === filter ? null : filter;
          filterOpen.value = false;
        };

        const toggleDropdown = (type) => {
          if (type === 'anim') {
            animOpen.value = !animOpen.value;
            filterOpen.value = false;
          } else {
            filterOpen.value = !filterOpen.value;
            animOpen.value = false;
          }
        };

        // Close dropdowns on outside click
        onMounted(() => {
          document.addEventListener('click', () => {
            animOpen.value = false;
            filterOpen.value = false;
          });
        });

        const duplicate = (item) => {
          items.value.push({
            ...item,
            id: nextId.value++,
            x: item.x + 30,
            y: item.y + 30,
            z: items.value.length
          });
        };

        const remove = (item) => {
          const idx = items.value.indexOf(item);
          if (idx > -1) items.value.splice(idx, 1);
          if (selectedId.value === item.id) selectedId.value = null;
        };

        const clearAll = () => {
          if (confirm('Clear all items?')) {
            items.value = [];
            selectedId.value = null;
          }
        };

        const itemStyle = (item) => ({
          left: `${item.x}px`,
          top: `${item.y}px`,
          width: `${item.width}px`,
          height: `${item.height}px`,
          zIndex: item.z,
          fontSize: item.type === 'emoji' ? `${item.width * 0.8}px` : '1em'
        });

        return {
          bgUrl, items, selectedId, mode, animOpen, filterOpen,
          emojis, samplePhotos,
          refreshBackground, drop, dragStart, uploadPhotos,
          setMode, selectAndDrag, startResize,
          bringToFront, sendToBack, setAnim, setFilter, toggleDropdown,
          duplicate, remove, clearAll, itemStyle
        };
      }
    }).mount('#app');
  </script>
</body>
</html>